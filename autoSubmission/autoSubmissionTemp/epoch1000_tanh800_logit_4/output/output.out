Training...
Train Config:  {'outdir': '/eos/user/d/dboncukc/fastsimTest/', 'trainingName': 'epoch1000_tanh800_logit_4', 'description': 'epoch1000_tanh800_logit', 'inputFile': '/eos/cms/store/group/comm_fastsim/RefinementTraining/T1ttttRun3_CMSSW_13_0_13/mc_fullfast_T1tttt_JetsMuonsElectronsPhotonsTausEvents.root', 'treeName': 'tJet', 'preSelection': '1', 'isTest': True, 'nEpochs': 1000, 'batchSize': 2048, 'numBatches': [500, 100, 200], 'logBase': None, 'tanhNorm': 800, 'modelInput': {'parameters': [('GenJet_pt', ['tanh', 'logit']), ('GenJet_eta', []), ('RecJet_hadronFlavour_FastSim', [])], 'variables': [('RecJet_pt_CLASS', ['tanh', 'logit']), ('RecJet_btagDeepFlavB_CLASS', ['logit']), ('RecJet_btagDeepFlavCvB_CLASS', ['logit']), ('RecJet_btagDeepFlavCvL_CLASS', ['logit']), ('RecJet_btagDeepFlavQG_CLASS', ['logit'])], 'spectators': ['GenJet_pt', 'GenJet_eta', 'GenJet_phi', 'GenJet_mass', 'GenJet_hadronFlavour', 'GenJet_partonFlavour']}}
selected device is cpu
Test Mode:  True
Input Path:  /eos/cms/store/group/comm_fastsim/RefinementTraining/T1ttttRun3_CMSSW_13_0_13/mc_fullfast_T1tttt_JetsMuonsElectronsPhotonsTausEvents.root
Tree Name:  tJet
Preselection:  1
Output Path:  /eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4/epoch1000_tanh800_logit_4.root
Number of Epochs:  2
Batch Size:  2048
Number of Batches:  [2, 2, 2]
logBase: None
tanhNorm: 800
PARAMETERS: [('GenJet_pt', ['tanh', 'logit']), ('GenJet_eta', []), ('RecJet_hadronFlavour_FastSim', [])]
VARIABLES: [('RecJet_pt_CLASS', ['tanh', 'logit']), ('RecJet_btagDeepFlavB_CLASS', ['logit']), ('RecJet_btagDeepFlavCvB_CLASS', ['logit']), ('RecJet_btagDeepFlavCvL_CLASS', ['logit']), ('RecJet_btagDeepFlavQG_CLASS', ['logit'])]
SPECTATORS: ['GenJet_pt', 'GenJet_eta', 'GenJet_phi', 'GenJet_mass', 'GenJet_hadronFlavour', 'GenJet_partonFlavour']

### get training data
ntest 4096

### build model
Sequential(
  (TanhTransform): TanhTransform()
  (LogitTransform): LogitTransform()
  (OneHotEncode_RecJet_hadronFlavour_FastSim): OneHotEncode()
  (LinearWithSkipConnection_0): LinearWithSkipConnection(
    (_linears): ModuleList(
      (0): Linear(in_features=10, out_features=1024, bias=True)
      (1): Linear(in_features=1024, out_features=1024, bias=True)
    )
    (_leakyrelus): ModuleList(
      (0): LeakyReLU(negative_slope=0.01)
      (1): LeakyReLU(negative_slope=0.01)
    )
    (_dropouts): ModuleList(
      (0): Dropout(p=0.2, inplace=False)
      (1): Dropout(p=0.2, inplace=False)
    )
  )
  (LinearWithSkipConnection_1): LinearWithSkipConnection(
    (_linears): ModuleList(
      (0): Linear(in_features=1024, out_features=1024, bias=True)
      (1): Linear(in_features=1024, out_features=1024, bias=True)
    )
    (_leakyrelus): ModuleList(
      (0): LeakyReLU(negative_slope=0.01)
      (1): LeakyReLU(negative_slope=0.01)
    )
    (_dropouts): ModuleList(
      (0): Dropout(p=0.2, inplace=False)
      (1): Dropout(p=0.2, inplace=False)
    )
  )
  (LinearWithSkipConnection_2): LinearWithSkipConnection(
    (_linears): ModuleList(
      (0): Linear(in_features=1024, out_features=1024, bias=True)
      (1): Linear(in_features=1024, out_features=1024, bias=True)
    )
    (_leakyrelus): ModuleList(
      (0): LeakyReLU(negative_slope=0.01)
      (1): LeakyReLU(negative_slope=0.01)
    )
    (_dropouts): ModuleList(
      (0): Dropout(p=0.2, inplace=False)
      (1): Dropout(p=0.2, inplace=False)
    )
  )
  (LinearWithSkipConnection_3): LinearWithSkipConnection(
    (_linears): ModuleList(
      (0): Linear(in_features=1024, out_features=1024, bias=True)
      (1): Linear(in_features=1024, out_features=1024, bias=True)
    )
    (_leakyrelus): ModuleList(
      (0): LeakyReLU(negative_slope=0.01)
      (1): LeakyReLU(negative_slope=0.01)
    )
    (_dropouts): ModuleList(
      (0): Dropout(p=0.2, inplace=False)
      (1): Dropout(p=0.2, inplace=False)
    )
  )
  (LinearWithSkipConnection_last): LinearWithSkipConnection(
    (_linears): ModuleList(
      (0): Linear(in_features=1024, out_features=1024, bias=True)
      (1): Linear(in_features=1024, out_features=5, bias=True)
    )
    (_leakyrelus): ModuleList(
      (0): LeakyReLU(negative_slope=0.01)
      (1): LeakyReLU(negative_slope=0.01)
    )
    (_dropouts): ModuleList(
      (0): Dropout(p=0.2, inplace=False)
      (1): Dropout(p=0.2, inplace=False)
    )
  )
  (LogitTransformBack): LogitTransformBack()
  (TanhTransformBack): TanhTransformBack()
  (CastTo16Bit): CastTo16Bit()
)
8413189 trainable parameters

### start training
LinearWithSkipConnection_0._linears.0.weight is on cpu
LinearWithSkipConnection_0._linears.0.bias is on cpu
LinearWithSkipConnection_0._linears.1.weight is on cpu
LinearWithSkipConnection_0._linears.1.bias is on cpu
LinearWithSkipConnection_1._linears.0.weight is on cpu
LinearWithSkipConnection_1._linears.0.bias is on cpu
LinearWithSkipConnection_1._linears.1.weight is on cpu
LinearWithSkipConnection_1._linears.1.bias is on cpu
LinearWithSkipConnection_2._linears.0.weight is on cpu
LinearWithSkipConnection_2._linears.0.bias is on cpu
LinearWithSkipConnection_2._linears.1.weight is on cpu
LinearWithSkipConnection_2._linears.1.bias is on cpu
LinearWithSkipConnection_3._linears.0.weight is on cpu
LinearWithSkipConnection_3._linears.0.bias is on cpu
LinearWithSkipConnection_3._linears.1.weight is on cpu
LinearWithSkipConnection_3._linears.1.bias is on cpu
LinearWithSkipConnection_last._linears.0.weight is on cpu
LinearWithSkipConnection_last._linears.0.bias is on cpu
LinearWithSkipConnection_last._linears.1.weight is on cpu
LinearWithSkipConnection_last._linears.1.bias is on cpu

# epoch 1

evaluate benchmarks and starting points

calculated BWs by dimension to be:
tensor([ 3.6721, 16.0217,  8.9831,  5.4597,  1.9889,  3.5624,  3.7707,  0.4969,  0.2115,  0.4877])

calculated BWs by dimension to be:
tensor([ 3.6721, 16.0217,  8.9831,  5.4597,  1.9889,  3.5624,  3.7707,  0.4969,  0.2115,  0.4877])

benchmarks
mmdfixsigma_output_target, mmdfixsigma_output_target_hadflavSum, mmd_output_target, mmd_output_target_hadflav0, mmd_output_target_hadflav4, mmd_output_target_hadflav5, mmd_output_target_hadflavSum, mse_output_target, mse_input_output, huber_output_target, huber_input_output, deepjetsum_mean, deepjetsum_std
0.004286536714062095, 0.010673101991415024, 0.0025149750290438533, 0.00590331107378006, 0.01972783822566271, 0.005506336456164718, 0.00732336426153779, 1.8177606463432312, 0.0, 0.08394067734479904, 0.0, 1.0000094771385193, 0.000654993491480127

start points
mmdfixsigma_output_target, mmdfixsigma_output_target_hadflavSum, mmd_output_target, mmd_output_target_hadflav0, mmd_output_target_hadflav4, mmd_output_target_hadflav5, mmd_output_target_hadflavSum, mse_output_target, mse_input_output, huber_output_target, huber_input_output, deepjetsum_mean, deepjetsum_std
0.004286536481231451, 0.010673101991415024, 0.002514975145459175, 0.00590331107378006, 0.01972783822566271, 0.005506336921826005, 0.00732336426153779, 1.8177608251571655, 1.8705082621695013e-11, 0.08394068107008934, 9.352541310847506e-12, 1.0000094771385193, 0.000654993491480127


training loop
batch 0
train_loss: cpu
tensor(0.0072, grad_fn=<AddBackward0>)
train loss 0.00718
batch 1
train_loss: cpu
tensor(0.0074, grad_fn=<AddBackward0>)
train loss 0.00740
[1 / 2] train loss: 0.0072924502

validation loop
batch 0
validation loss 0.00686
batch 1
validation loss 0.00667
[1 / 2] validation loss: 0.0072924502

# epoch 2

training loop
batch 0
train_loss: cpu
tensor(0.0070, grad_fn=<AddBackward0>)
train loss 0.00705
batch 1
train_loss: cpu
tensor(0.0073, grad_fn=<AddBackward0>)
train loss 0.00726
[2 / 2] train loss: 0.0071564254

validation loop
batch 0
validation loss 0.00678
batch 1
validation loss 0.00659
[2 / 2] validation loss: 0.0071564254

end points train
mmdfixsigma_output_target, mmdfixsigma_output_target_hadflavSum, mmd_output_target, mmd_output_target_hadflav0, mmd_output_target_hadflav4, mmd_output_target_hadflav5, mmd_output_target_hadflavSum, mse_output_target, mse_input_output, huber_output_target, huber_input_output, deepjetsum_mean, deepjetsum_std
0.004030797630548477, 0.010252523701637983, 0.0024473919766023755, 0.005665342323482037, 0.01947932504117489, 0.005437554558739066, 0.0071559997741132975, 1.8165872693061829, 0.00026125477597815916, 0.08388073742389679, 0.00013062738798907958, 0.9997441470623016, 0.0013007809757255018

end points validation
mmdfixsigma_output_target, mmdfixsigma_output_target_hadflavSum, mmd_output_target, mmd_output_target_hadflav0, mmd_output_target_hadflav4, mmd_output_target_hadflav5, mmd_output_target_hadflavSum, mse_output_target, mse_input_output, huber_output_target, huber_input_output, deepjetsum_mean, deepjetsum_std
0.003723291913047433, 0.009599552024155855, 0.0022499136393889785, 0.005040197866037488, 0.018868759274482727, 0.005168253323063254, 0.006683578714728355, 1.8490575551986694, 0.0005500054394360632, 0.08450349792838097, 0.0002750027197180316, 0.9986254274845123, 0.0013811523676849902

end of cheeky loop

saving model

just created /eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4/epoch1000_tanh800_logit_4.pt
just created /eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4/epoch1000_tanh800_logit_4.root
just created /eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4/epoch1000_tanh800_logit_4_train.csv
just created /eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4/epoch1000_tanh800_logit_4_validation.csv


..::The Story has been ended::..

plotLearningCurves
out_path /eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4//plots/learningCurves

### read csv files
hopefully this exists /eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4/epoch1000_tanh800_logit_4_train.csv
starts [['mmdfixsigma_output_target', 0.004286536481231451], ['mmdfixsigma_output_target_hadflavSum', 0.010673101991415024], ['mmd_output_target', 0.002514975145459175], ['mmd_output_target_hadflav0', 0.00590331107378006], ['mmd_output_target_hadflav4', 0.01972783822566271], ['mmd_output_target_hadflav5', 0.005506336921826005], ['mmd_output_target_hadflavSum', 0.00732336426153779], ['mse_output_target', 1.8177608251571655], ['mse_input_output', 1.8705082621695013e-11], ['huber_output_target', 0.08394068107008934], ['huber_input_output', 9.352541310847506e-12], ['deepjetsum_mean', 1.0000094771385193], ['deepjetsum_std', 0.000654993491480127], ['lmbda_deepjetsum_mean', 0.0], ['lmbda_deepjetsum_std', 0.0]]
hopefully this exists too /eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4/epoch1000_tanh800_logit_4_validation.csv
starts [['mmdfixsigma_output_target', 0.004117858596146107], ['mmdfixsigma_output_target_hadflavSum', 0.010234728921204805], ['mmd_output_target', 0.0023541568079963326], ['mmd_output_target_hadflav0', 0.005457988940179348], ['mmd_output_target_hadflav4', 0.019172709435224533], ['mmd_output_target_hadflav5', 0.005220018560066819], ['mmd_output_target_hadflavSum', 0.006932918215170503], ['mse_output_target', 1.8505379557609558], ['mse_input_output', 1.588080708603279e-11], ['huber_output_target', 0.08459531888365746], ['huber_input_output', 7.940403543016394e-12], ['deepjetsum_mean', 1.0000053644180298], ['deepjetsum_std', 0.0006410368951037526], ['lmbda_deepjetsum_mean', 0.0], ['lmbda_deepjetsum_std', 0.0]]
done with that

### make plots
plot_name mmdfixsigma_output_target
just created /eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4//plots/learningCurves_mmdfixsigma_output_target.png
plot_name mmd_output_target
just created /eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4//plots/learningCurves_mmd_output_target.png
plot_name mse_output_target
just created /eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4//plots/learningCurves_mse_output_target.png
plot_name mse_input_output
just created /eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4//plots/learningCurves_mse_input_output.png
plotWeights
just created /eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4/plots/weights_epoch1000_tanh800_logit_4.png
plotPareto
/eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4/epoch1000_tanh800_logit_4_train.csv
### read csv files
epoch1000_tanh800_logit_4
epoch1000_tanh800_logit_4
epoch1000_tanh800_logit_4
### make plots
just created /eos/user/d/dboncukc/fastsimTest/epoch1000_tanh800_logit_4/plots/pareto_epoch1000_tanh800_logit_4_train.png
plotRegression1D
RecJet_pt
drawing RecJet_pt_FullSim
drawing RecJet_pt_FastSim
drawing RecJet_pt_Refined
drawing RecJet_pt_Refined
RecJet_btagDeepFlavB_logit
drawing RecJet_btagDeepFlavB_FullSim
drawing RecJet_btagDeepFlavB_FastSim
drawing RecJet_btagDeepFlavB_Refined
drawing RecJet_btagDeepFlavB_Refined
RecJet_btagDeepFlavCvB_logit
drawing RecJet_btagDeepFlavCvB_FullSim
drawing RecJet_btagDeepFlavCvB_FastSim
drawing RecJet_btagDeepFlavCvB_Refined
drawing RecJet_btagDeepFlavCvB_Refined
RecJet_btagDeepFlavCvL_logit
drawing RecJet_btagDeepFlavCvL_FullSim
drawing RecJet_btagDeepFlavCvL_FastSim
drawing RecJet_btagDeepFlavCvL_Refined
drawing RecJet_btagDeepFlavCvL_Refined
RecJet_btagDeepFlavQG_logit
drawing RecJet_btagDeepFlavQG_FullSim
drawing RecJet_btagDeepFlavQG_FastSim
drawing RecJet_btagDeepFlavQG_Refined
drawing RecJet_btagDeepFlavQG_Refined
plotRegressionCorrelationFactors
full
fast
refined
All Done
